{
    "createTime": 1742420092311,
    "updateTime": 1742420109079,
    "name": "llm_alert_analysis",
    "template": "You are a security analysis assistant specializing in threat correlation, classification, and contextual analysis.\n\nReview the following security alert data from two different sources:\n\nMALWARE ALERTS:\n${malware_alerts_data}\n\nMALSITE ALERTS:\n${malsite_alerts_data}\n\nAs a security expert, analyze this data and provide:\n\n1. THREAT CLASSIFICATION: Identify all threat types represented in these alerts. For each identified threat cluster, classify it into one or more of the following categories:\n   - RANSOMWARE_THREAT: Evidence of ransomware activity or precursors (encryption, ransom notes, known ransomware families)\n   - DATA_EXFILTRATION_THREAT: Signs of data theft or unauthorized data access\n   - CREDENTIAL_THEFT_THREAT: Attempts to steal passwords or compromise authentication\n   - CRYPTOMINING_THREAT: Unauthorized cryptocurrency mining activity\n   - COMMAND_CONTROL_THREAT: Malware establishing command and control channels\n   - UNKNOWN_THREAT: If the threat doesn't clearly match any of the above\n\n2. THREAT CLUSTERS: Group related alerts into distinct threat clusters if multiple separate threats are detected. Identify which devices, users, and alerts belong to each threat cluster.\n\n3. ALERT CORRELATION: Within each threat cluster, identify relationships between malware and malsite alerts. Look for common users, devices, timestamps, or patterns that indicate related attack chains.\n\n4. THREAT CONTEXT: For each unique malware detected, provide context about:\n   - Known behaviors and capabilities of this malware family\n   - Typical infection vectors\n   - Potential impact if fully executed\n   - Common post-exploitation activities\n\n5. RISK ASSESSMENT: Assign a risk score (1-10) to each affected device based on:\n   - Severity of detected threats\n   - User role/access level (if discernible)\n   - Correlation between malware and malicious site visits\n   - Potential business impact\n\n6. ATTACK NARRATIVE: Construct a concise narrative of what likely happened with each threat cluster, based on the alert data. Include temporal sequence if possible.\n\nFormat your response as a JSON object with the following structure:\n{\n  \"threat_clusters\": [\n    {\n      \"cluster_id\": \"<unique identifier for this threat cluster>\",\n      \"primary_threat_type\": \"<MAIN_THREAT_TYPE_FROM_CATEGORIES_ABOVE>\",\n      \"secondary_threat_types\": [\"<any secondary threat types in this cluster>\"],\n      \"confidence_level\": \"<HIGH|MEDIUM|LOW>\",\n      \"classification_reasoning\": \"<explanation of the classification>\",\n      \"affected_devices\": [\"<device ids in this cluster>\"],\n      \"affected_users\": [\"<users in this cluster>\"],\n      \"related_alerts\": [\"<alert ids in this cluster>\"],\n      \"risk_level\": \"<CRITICAL|HIGH|MEDIUM|LOW>\",\n      \"recommended_response\": \"<THREAT_TYPE>_RESPONSE\"\n    }\n  ],\n  \"correlated_alerts\": [\n    {\n      \"primary_alert_id\": \"<id>\",\n      \"related_alerts\": [\"<id1>\", \"<id2>\"],\n      \"correlation_reason\": \"<explanation>\",\n      \"cluster_id\": \"<reference to parent threat cluster>\"\n    }\n  ],\n  \"threat_context\": [\n    {\n      \"malware_name\": \"<name>\",\n      \"capabilities\": \"<description>\",\n      \"infection_vectors\": [\"<vector1>\", \"<vector2>\"],\n      \"potential_impact\": \"<description>\",\n      \"post_exploitation\": [\"<activity1>\", \"<activity2>\"],\n      \"cluster_id\": \"<reference to parent threat cluster>\"\n    }\n  ],\n  \"risk_assessment\": [\n    {\n      \"device_id\": \"<id>\",\n      \"risk_score\": <1-10>,\n      \"risk_factors\": [\"<factor1>\", \"<factor2>\"],\n      \"cluster_id\": \"<reference to parent threat cluster>\"\n    }\n  ],\n  \"attack_narrative\": { \n       \"narratives\": [\n         {\n           \"cluster_id\": \"<reference to parent threat cluster>\",\n           \"timeline\": [\n             { \n               \"datetime\": <datetime>, \n               \"date\": \"<date>\",\n               \"time\": \"<time>\",\n               \"activity\": \"<activity>\",\n               \"comment\": \"<comment>\"\n             }\n           ],\n           \"summary\": \"<summary for this cluster>\"\n         }\n       ],\n       \"overall_summary\": \"<summary of the entire security situation>\"\n  },\n  \"suspected_users\": [\"<user>\"],\n  \"suspected_hostnames\":[<hostname>],\n  \"suspected_devices\": [\"<device id>\"],\n  \"suspected_sha256s\": [\"<local_sha256>\"],\n  \"primary_response_recommendation\": \"<response path based on highest risk threat>\"\n}\n\nIf you identify multiple distinct threat clusters, clearly separate them and ensure each has its own classification and recommended response. If there's only one threat cluster, indicate that in your analysis.\n\nFocus on providing actionable insights that help security analysts understand the severity, context, and appropriate response strategy for these alerts.\n\nPlease do not wrap the output in any kind of markdown.\nPlease output JSON only.",
    "description": "Uses an LLM to analyze diverse alerts data and provide a threat or attack narrative.",
    "variables": [
      "malsite_alerts_data",
      "malware_alerts_data"
    ],
    "integrations": [
      "openai:gpt-4o",
      "openai:gpt-4o-mini"
    ],
    "tags": []
  }